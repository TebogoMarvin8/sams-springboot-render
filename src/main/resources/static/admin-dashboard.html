<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAMS Admin Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap');

        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --background-color: #f4f6f9;
            --text-color: #333;
            --border-color: #ddd;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 250px;
            background-color: #2c3e50;
            color: white;
            padding: 20px;
        }

        .sidebar h1 {
            font-size: 24px;
            margin-bottom: 30px;
            text-align: center;
        }

        .sidebar-menu {
            list-style-type: none;
        }

        .sidebar-menu li {
            margin-bottom: 10px;
        }

        .sidebar-menu button {
            width: 100%;
            padding: 10px;
            text-align: left;
            background-color: transparent;
            border: none;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .sidebar-menu button:hover {
            background-color: #34495e;
        }

        .sidebar-menu i {
            margin-right: 10px;
        }

        .main-content {
            flex-grow: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .dashboard-section {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 30px;
        }

        .dashboard-section h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 24px;
        }

        form div {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        input[type="text"],
        input[type="email"],
        input[type="number"],
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 16px;
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #2980b9;
        }

        .cancel-button {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        .cancel-button:hover {
            background-color: #c0392b;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th,
        td {
            border: 1px solid var(--border-color);
            padding: 12px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
            font-weight: 500;
        }

        .edit-button,
        .delete-button {
            padding: 6px 12px;
            margin-right: 5px;
            border-radius: 4px;
            font-size: 14px;
        }

        .edit-button {
            background-color: var(--secondary-color);
        }

        .edit-button:hover {
            background-color: #27ae60;
        }

        .delete-button {
            background-color: #e74c3c;
        }

        .delete-button:hover {
            background-color: #c0392b;
        }

        #edit-student-form,
        #edit-instructor-form {
            display: none;
        }
    </style>
</head>

<body>
    <div class="dashboard-container">
        <aside class="sidebar">
            <h1>SAMS Admin</h1>
            <ul class="sidebar-menu">
                <li><button onclick="showSection('create-course-form')"><i class="fas fa-book"></i> Create
                        Course</button></li>
                <li><button onclick="showCoursesTable()"><i class="fas fa-edit"></i> Edit Courses</button></li>

                <li><button onclick="showSection('create-class-form')"><i class="fas fa-users"></i> Create
                        Class</button></li>
                <li><button onclick="showClassesTable()"><i class="fas fa-edit"></i> Edit Classes</button></li>

                <li><button onclick="showSection('assign-instructor-form')"><i class="fas fa-user-tie"></i> Assign
                        Instructor</button></li>
                <li><button onclick="showSection('reports-section')"><i class="fas fa-chart-bar"></i> Reports</button>
                </li>
                <li><button onclick="showStudentsTable()"><i class="fas fa-user-edit"></i> Edit Students</button></li>
                <li><button onclick="showInstructorsTable()"><i class="fas fa-user-edit"></i> Edit Instructors</button>
                </li>
                <li><button onclick="showSection('manage-tags-section')"><i class="fas fa-id-card"></i> Manage
                        Tags</button></li>
            <li><button onclick="logout()" style="background-color: #e74c3c;"><i class="fas fa-sign-out-alt"></i> Logout</button></li>
                <li><button onclick="hideAllSections()"><i class="fas fa-times"></i> Close All</button></li>
            </ul>
        </aside>
        <main class="main-content">
            <!-- Courses Table Section -->
            <section id="courses-table-section" class="dashboard-section" style="display: none;">
                <h2>Manage Courses</h2>
                <table id="coursesTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Course Name</th>
                            <th>Course Code</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Rows will be populated by JavaScript -->
                    </tbody>
                </table>
            </section>

            <!-- Edit Course Form Section -->
            <section id="edit-course-form" class="dashboard-section" style="display: none;">
                <h2>Edit Course</h2>
                <form onsubmit="editCourse(event)">
                    <div>
                        <label for="editCourseId">Course ID:</label>
                        <input type="text" id="editCourseId" name="id" readonly disabled>
                    </div>
                    <div>
                        <label for="editCourseName">Course Name:</label>
                        <input type="text" id="editCourseName" name="courseName" required>
                    </div>
                    <div>
                        <label for="editCourseCode">Course Code:</label>
                        <input type="text" id="editCourseCode" name="courseCode" required>
                    </div>
                    <div>
                        <button type="submit">Save Changes</button>
                        <button type="button" class="cancel-button" onclick="hideEditCourseForm()">Cancel</button>
                    </div>
                </form>
            </section>

            <!-- Classes Table Section -->
            <section id="classes-table-section" class="dashboard-section" style="display: none;">
                <h2>Manage Classes</h2>
                <table id="classesTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Class Name</th>
                            <th>Start Time</th>
                            <th>End Time</th>
                            <th>Day of Week</th>
                            <th>Course Name</th>
                            <th>Course Code</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Rows will be populated by JavaScript -->
                    </tbody>
                </table>
            </section>

            <!-- Edit Class Form Section -->
            <section id="edit-class-form" class="dashboard-section" style="display: none;">
                <h2>Edit Class</h2>
                <form onsubmit="editClass(event)">
                    <div>
                        <label for="editClassId">Class ID:</label>
                        <input type="text" id="editClassId" name="id" readonly disabled>
                    </div>
                    <div>
                        <label for="editClassName">Class Name:</label>
                        <input type="text" id="editClassName" name="className" required>
                    </div>
                    <div>
                        <label for="editStartTime">Start Time:</label>
                        <input type="time" id="editStartTime" name="startTime" required>
                    </div>
                    <div>
                        <label for="editEndTime">End Time:</label>
                        <input type="time" id="editEndTime" name="endTime" required>
                    </div>
                    <div>
                        <label for="editDayOfWeek">Day of Week:</label>
                        <select id="editDayOfWeek" name="dayOfWeek" required>
                            <option value="MONDAY">Monday</option>
                            <option value="TUESDAY">Tuesday</option>
                            <option value="WEDNESDAY">Wednesday</option>
                            <option value="THURSDAY">Thursday</option>
                            <option value="FRIDAY">Friday</option>
                            <option value="SATURDAY">Saturday</option>
                            <option value="SUNDAY">Sunday</option>
                        </select>
                    </div>
                    <div>
                        <label for="editCourseDropdown">Course:</label>
                        <select id="editCourseDropdown" name="courseId" required>
                            <!-- Options will be populated by JavaScript -->
                        </select>
                    </div>
                    <div>
                        <button type="submit">Save Changes</button>
                        <button type="button" class="cancel-button" onclick="hideEditClassForm()">Cancel</button>
                    </div>
                </form>
            </section>
            <!-- Create Course Section -->
            <section id="create-course-form" class="dashboard-section">
                <h2>Create New Course</h2>
                <form onsubmit="createCourse(event)">
                    <div>
                        <label for="courseName">Course Name:</label>
                        <input type="text" id="courseName" name="name" required>
                    </div>
                    <div>
                        <label for="courseCode">Course Code:</label>
                        <input type="text" id="courseCode" name="code" required>
                    </div>
                    <div>
                        <button type="submit">Create Course</button>
                    </div>
                </form>
            </section>

            <!-- Create Class Section -->
            <section id="create-class-form" class="dashboard-section">
                <h2>Create New Class</h2>
                <form onsubmit="createClass(event)">
                    <div>
                        <label for="className">Class Name:</label>
                        <input type="text" id="className" name="className" required>
                    </div>
                    <div>
                        <label for="startTime">Start Time:</label>
                        <input type="time" id="startTime" name="startTime" required>
                    </div>
                    <div>
                        <label for="endTime">End Time:</label>
                        <input type="time" id="endTime" name="endTime" required>
                    </div>
                    <div>
                        <label for="dayOfWeek">Day of Week:</label>
                        <select id="dayOfWeek" name="dayOfWeek" required>
                            <option value="MONDAY">Monday</option>
                            <option value="TUESDAY">Tuesday</option>
                            <option value="WEDNESDAY">Wednesday</option>
                            <option value="THURSDAY">Thursday</option>
                            <option value="FRIDAY">Friday</option>
                            <option value="SATURDAY">Saturday</option>
                            <option value="SUNDAY">Sunday</option>
                        </select>
                    </div>
                    <div>
                        <label for="courseDropdown">Course:</label>
                        <select id="courseDropdown" name="courseId" required>
                            <!-- Options will be populated here by JavaScript -->
                        </select>
                    </div>
                    <div>
                        <button type="submit">Create Class</button>
                    </div>
                </form>
            </section>

            <!-- Assign Instructor to Class Section -->
            <section id="assign-instructor-form" class="dashboard-section">
                <h2>Assign Instructor to Class</h2>
                <form onsubmit="assignInstructorToClass(event)">
                    <div>
                        <label for="instructorDropdownForAssignment">Instructor:</label>
                        <select id="instructorDropdownForAssignment" name="instructorId" required>
                            <!-- Options will be populated here by JavaScript -->
                        </select>
                    </div>

                    <div>
                        <label for="classDropdown">Class:</label>
                        <select id="classDropdown" name="classId" required>
                            <!-- Options will be populated here by JavaScript -->
                        </select>
                    </div>
                    <div>
                        <button type="submit">Assign Instructor</button>
                    </div>
                </form>
            </section>

            <!-- Generate and Download Reports Section -->
            <section id="reports-section" class="dashboard-section">
                <h2>Generate and Download Reports</h2>
                <button onclick="viewReports()">View Reports</button>
            </section>

            <!-- Students Table Section -->
            <section id="students-table-section" class="dashboard-section">
                <h2>Manage Students</h2>
                <table id="studentsTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>First Name</th>
                            <th>Last Name</th>
                            <th>Email</th>
                            <th>Tag Number</th>
                            <th>Username</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Rows will be populated by JavaScript -->
                    </tbody>
                </table>
            </section>

            <!-- Edit Student Form Section -->
            <section id="edit-student-form" class="dashboard-section" style="display: none;">
                <h2>Edit Student</h2>
                <form onsubmit="editStudent(event)">
                    <div>
                        <label for="editStudentId">Student ID:</label>
                        <input type="number" id="editStudentId" name="studentId" readonly disabled>
                    </div>
                    <div>
                        <label for="editStudentFirstName">First Name:</label>
                        <input type="text" id="editStudentFirstName" name="firstName" required>
                    </div>
                    <div>
                        <label for="editStudentLastName">Last Name:</label>
                        <input type="text" id="editStudentLastName" name="lastName" required>
                    </div>
                    <div>
                        <label for="editStudentEmail">Email:</label>
                        <input type="email" id="editStudentEmail" name="email" required>
                    </div>
                    <div>
                        <label for="editRFIDTagDropdown">RFID Tag:</label>
                        <select id="editRFIDTagDropdown" name="rfidTagId" required>
                            <!-- Options will be populated here by JavaScript -->
                        </select>
                    </div>
                    <div>
                        <label for="editUserDropdown">User:</label>
                        <select id="editUserDropdown" name="userId" required disabled>
                            <!-- Options will be populated here by JavaScript -->
                        </select>
                    </div>
                    <div>
                        <button type="submit">Save Changes</button>
                        <button type="button" class="cancel-button" onclick="hideEditForm()">Cancel</button>
                    </div>
                </form>
            </section>

            <!-- Instructors Table Section -->
            <section id="instructors-table-section" class="dashboard-section" style="display: none;">
                <h2>Manage Instructors</h2>
                <table id="instructorsTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>First Name</th>
                            <th>Last Name</th>
                            <th>Email</th>
                            <th>Username</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Rows will be populated by JavaScript -->
                    </tbody>
                </table>
            </section>

            <!-- Edit Instructor Form Section -->
            <section id="edit-instructor-form" class="dashboard-section" style="display: none;">
                <h2>Edit Instructor</h2>
                <form onsubmit="editInstructor(event)">
                    <div>
                        <label for="editInstructorId">Instructor ID:</label>
                        <input type="text" id="editInstructorId" name="id" readonly disabled>
                    </div>
                    <div>
                        <label for="editInstructorFirstName">First Name:</label>
                        <input type="text" id="editInstructorFirstName" name="firstName" required>
                    </div>
                    <div>
                        <label for="editInstructorLastName">Last Name:</label>
                        <input type="text" id="editInstructorLastName" name="lastName" required>
                    </div>
                    <div>
                        <label for="editInstructorEmail">Email:</label>
                        <input type="email" id="editInstructorEmail" name="email" required>
                    </div>
                    <div>
                        <label for="editUserDropdownInt">User:</label>
                        <select id="editUserDropdownInt" name="userId" required disabled>
                            <!-- Options will be populated here by JavaScript -->
                        </select>
                    </div>
                    <div>
                        <button type="submit">Save Changes</button>
                        <button type="button" class="cancel-button" onclick="hideEditInstructorForm()">Cancel</button>
                    </div>
                </form>
            </section>

            <!-- Manage Tags Section -->
            <section id="manage-tags-section" class="dashboard-section">
                <h2>Manage RFID Tags</h2>

                <!-- Create Tag Form -->
                <h3>Create New RFID Tag</h3>
                <form onsubmit="createRFIDTag(event)">
                    <div>
                        <label for="newTagNumber">Tag Number:</label>
                        <input type="text" id="newTagNumber" name="tagNumber" required>
                    </div>
                    <div>
                        <button type="submit">Create Tag</button>
                    </div>
                </form>

                <!-- Assign Tag Form -->
                <h3>Assign RFID Tag to Student</h3>
                <form onsubmit="assignRFIDTag(event)">
                    <div>
                        <label for="studentDropdown">Student:</label>
                        <select id="studentDropdown" name="studentId" required>
                            <!-- Options will be populated by JavaScript -->
                        </select>
                    </div>
                    <div>
                        <label for="unassignedTagDropdown">RFID Tag:</label>
                        <select id="unassignedTagDropdown" name="rfidTagId" required>
                            <!-- Options will be populated by JavaScript -->
                        </select>
                    </div>
                    <div>
                        <button type="submit">Assign Tag</button>
                    </div>
                </form>
            </section>

    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            hideAllSections();
            populateRFIDDropdown();
            populateCoursesDropdown();
            populateUserDropdownForInstructor();
            populateClassesDropdown();
            populateInstructorDropdownForAssignment();
            populateStudentsDropdown();
            populateUnassignedTagsDropdown();
        });

        function showSection(sectionId) {
            // Hide all dashboard sections
            document.querySelectorAll('.dashboard-section').forEach(section => {
                section.style.display = 'none';
            });

            // Show the selected section
            const selectedSection = document.getElementById(sectionId);
            if (selectedSection) {
                selectedSection.style.display = 'block';
            }

            // If the assign instructor form is shown, populate the dropdowns
            if (sectionId === 'assign-instructor-form') {
                populateInstructorDropdownForAssignment();
                populateClassesDropdown();
            }
            // If the manage tags section is shown, populate the dropdowns
            if (sectionId === 'manage-tags-section') {
                populateStudentsDropdown();
                populateUnassignedTagsDropdown();
            }
        }
        
        function logout() {
            alert("You have been logged out.");
            window.location.href = 'login.html';
            sessionStorage.clear();
        }

        function hideAllSections() {
            document.querySelectorAll('.dashboard-section').forEach(section => {
                section.style.display = 'none';
            });
        }
        // Function to show the students table and hide the instructors table
        function showStudentsTable() {
            hideAllSections();
            document.getElementById('students-table-section').style.display = 'block';
            fetchAndDisplayStudents();
        }

        function showInstructorsTable() {
            hideAllSections();
            document.getElementById('instructors-table-section').style.display = 'block';
            fetchAndDisplayInstructors();
        }


        function showCoursesTable() {
            hideAllSections();
            document.getElementById('courses-table-section').style.display = 'block';
            fetchAndDisplayCourses();
        }

        function showClassesTable() {
            hideAllSections();
            document.getElementById('classes-table-section').style.display = 'block';
            fetchAndDisplayClasses();
        }

        async function fetchAndDisplayCourses() {
            try {
                const response = await fetch('http://localhost:8080/api/admins/courses');
                const courses = await response.json();

                const tableBody = document.querySelector('#coursesTable tbody');
                tableBody.innerHTML = ''; // Clear existing rows

                courses.forEach(course => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${course.id}</td>
                        <td>${course.courseName}</td>
                        <td>${course.courseCode}</td>
                        <td>
                            <button class="edit-button" onclick="showEditCourseForm(${course.id})">Edit</button>
                            <button class="delete-button" onclick="deleteCourse(${course.id})">Delete</button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            } catch (error) {
                console.error('Error fetching courses:', error);
                alert('Error fetching courses: ' + error.message);
            }
        }

        async function showEditCourseForm(courseId) {
            try {
                const response = await fetch(`http://localhost:8080/api/admins/courses/${courseId}`);
                const course = await response.json();

                document.getElementById('editCourseId').value = course.id;
                document.getElementById('editCourseName').value = course.courseName;
                document.getElementById('editCourseCode').value = course.courseCode;

                document.getElementById('courses-table-section').style.display = 'none';
                document.getElementById('edit-course-form').style.display = 'block';
            } catch (error) {
                console.error('Error fetching course details:', error);
                alert('Error fetching course details: ' + error.message);
            }
        }

        function hideEditCourseForm() {
            document.getElementById('edit-course-form').style.display = 'none';
            document.getElementById('courses-table-section').style.display = 'block';
        }

        async function editCourse(event) {
            event.preventDefault();
            const courseId = document.getElementById('editCourseId').value;
            const courseName = document.getElementById('editCourseName').value;
            const courseCode = document.getElementById('editCourseCode').value;

            try {
                const response = await fetch('http://localhost:8080/api/admins/courses', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        id: parseInt(courseId),
                        courseName,
                        courseCode
                    })
                });

                if (response.ok) {
                    alert('Course updated successfully!');
                    hideEditCourseForm();
                    fetchAndDisplayCourses();
                } else {
                    const result = await response.json();
                    alert('Error updating course: ' + (result.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error updating course: ' + error.message);
            }
        }

        async function deleteCourse(courseId) {
            if (!confirm('Are you sure you want to delete this course?')) {
                return;
            }

            try {
                const response = await fetch(`http://localhost:8080/api/admins/courses/${courseId}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    alert('Course deleted successfully!');
                    fetchAndDisplayCourses();
                } else {
                    alert('Error deleting course.');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error deleting course: ' + error.message);
            }
        }

        async function fetchAndDisplayClasses() {
            try {
                const response = await fetch('http://localhost:8080/api/admins/classes');
                const classes = await response.json();

                const tableBody = document.querySelector('#classesTable tbody');
                tableBody.innerHTML = ''; // Clear existing rows

                classes.forEach(classItem => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${classItem.id}</td>
                        <td>${classItem.className}</td>
                        <td>${classItem.startTime}</td>
                        <td>${classItem.endTime}</td>
                        <td>${classItem.dayOfWeek}</td>
                        <td>${classItem.course ? classItem.course.courseName : 'N/A'}</td>
                        <td>${classItem.course ? classItem.course.courseCode : 'N/A'}</td>
                        <td>
                            <button class="edit-button" onclick="showEditClassForm(${classItem.id})">Edit</button>
                            <button class="delete-button" onclick="deleteClass(${classItem.id})">Delete</button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            } catch (error) {
                console.error('Error fetching classes:', error);
                alert('Error fetching classes: ' + error.message);
            }
        }

        // New function for populating courses dropdown in the edit form
        async function populateEditCoursesDropdown() {
            try {
                const response = await fetch('http://localhost:8080/api/admins/courses');
                const courses = await response.json();

                const dropdown = document.getElementById('editCourseDropdown');
                dropdown.innerHTML = ''; // Clear existing options
                courses.forEach(course => {
                    const option = document.createElement('option');
                    option.value = course.id;
                    option.textContent = `${course.courseName} (${course.courseCode})`;
                    dropdown.appendChild(option);
                });
            } catch (error) {
                console.error('Error fetching courses for edit form:', error);
                alert('Error fetching courses: ' + error.message);
            }
        }

        // Updated showEditClassForm function
        async function showEditClassForm(classId) {
            try {
                const response = await fetch(`http://localhost:8080/api/admins/classes/${classId}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const classItem = await response.json();

                document.getElementById('editClassId').value = classItem.id;
                document.getElementById('editClassName').value = classItem.className;
                document.getElementById('editStartTime').value = classItem.startTime;
                document.getElementById('editEndTime').value = classItem.endTime;
                document.getElementById('editDayOfWeek').value = classItem.dayOfWeek;

                // Populate the course dropdown for the edit form
                await populateEditCoursesDropdown();

                // Set the currently selected course in the dropdown
                const editCourseDropdown = document.getElementById('editCourseDropdown');
                if (classItem.course && classItem.course.id) {
                    editCourseDropdown.value = classItem.course.id;
                } else {
                    console.warn('No course associated with this class');
                }

                document.getElementById('classes-table-section').style.display = 'none';
                document.getElementById('edit-class-form').style.display = 'block';

            } catch (error) {
                console.error('Error in showEditClassForm:', error);
                alert('Error fetching class details: ' + error.message);
            }
        }

        async function editClass(event) {
            event.preventDefault();
            const classId = document.getElementById('editClassId').value;
            const className = document.getElementById('editClassName').value;
            const startTime = document.getElementById('editStartTime').value;
            const endTime = document.getElementById('editEndTime').value;
            const dayOfWeek = document.getElementById('editDayOfWeek').value;
            const courseId = document.getElementById('editCourseDropdown').value;

            try {
                const response = await fetch('http://localhost:8080/api/admins/classes', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        id: parseInt(classId),
                        className,
                        startTime,
                        endTime,
                        dayOfWeek,
                        course: { id: parseInt(courseId) }
                    })
                });

                if (response.ok) {
                    alert('Class updated successfully!');
                    hideEditClassForm();
                    fetchAndDisplayClasses();
                } else {
                    const result = await response.json();
                    alert('Error updating class: ' + (result.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error updating class: ' + error.message);
            }
        }

        function hideEditClassForm() {
            document.getElementById('edit-class-form').style.display = 'none';
            document.getElementById('classes-table-section').style.display = 'block';
        }

        async function deleteClass(classId) {
            if (!confirm('Are you sure you want to delete this class?')) {
                return;
            }

            try {
                const response = await fetch(`http://localhost:8080/api/admins/classes/${classId}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    alert('Class deleted successfully!');
                    fetchAndDisplayClasses();
                } else {
                    alert('Error deleting class.');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error deleting class: ' + error.message);
            }
        }

        function onEditInstructorButtonClick() {
            // Show the instructors table
            showInstructorsTable();
        }

        async function populateRFIDDropdown() {
            try {
                const response = await fetch('http://localhost:8080/api/rfid-tags/unassigned');
                const rfidTags = await response.json();

                const dropdown = document.getElementById('rfidTagDropdown'); // Ensure this ID matches
                rfidTags.forEach(tag => {
                    const option = document.createElement('option');
                    option.value = tag.id;
                    option.textContent = tag.tagNumber;
                    dropdown.appendChild(option);
                });
            } catch (error) {
                console.error('Error fetching RFID tags:', error);
                // Optionally handle errors here, such as showing an error message
            }
        }

        function createCourse(event) {
            event.preventDefault();

            // Get the form fields by their ID
            const courseName = document.getElementById('courseName').value;
            const courseCode = document.getElementById('courseCode').value;

            // Create an object with the form data
            const courseData = {
                courseName: courseName,
                courseCode: courseCode
            };

            // Send the POST request to the API endpoint
            fetch('http://localhost:8080/api/admins/courses', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(courseData)
            })
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        return response.json().then(errorData => {
                            throw new Error(errorData.message || 'Something went wrong!');
                        });
                    }
                })
                .then(data => {
                    // Handle successful course creation
                    alert('Course created successfully!');
                    console.log('Course created:', data);

                    // Optionally, reset the form fields
                    document.getElementById('courseName').value = '';
                    document.getElementById('courseCode').value = '';
                })
                .catch(error => {
                    // Handle errors during course creation
                    console.error('Error:', error);
                    alert('Failed to create course: ' + error.message);
                });
        }


        async function populateCoursesDropdown() {
            try {
                const response = await fetch('http://localhost:8080/api/admins/courses'); // Endpoint to fetch courses
                const courses = await response.json();

                const dropdown = document.getElementById('courseDropdown');
                dropdown.innerHTML = ''; // Clear existing options
                courses.forEach(course => {
                    const option = document.createElement('option');
                    option.value = course.id; // Use course ID for the value
                    option.textContent = `${course.courseName} (${course.courseCode})`; // Display course name and code
                    dropdown.appendChild(option);
                });
            } catch (error) {
                console.error('Error fetching courses:', error);
                // Optionally handle errors here, such as showing an error message
            }
        }

        async function createClass(event) {
            event.preventDefault();

            // Collect form data
            const className = document.getElementById('className').value;
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            const dayOfWeek = document.getElementById('dayOfWeek').value;
            const courseId = document.getElementById('courseDropdown').value;

            // Construct the payload
            const payload = {
                className: className,
                startTime: startTime,
                endTime: endTime,
                dayOfWeek: dayOfWeek,
                course: {
                    id: parseInt(courseId)
                }
            };

            // Send the payload to the server
            try {
                const response = await fetch('http://localhost:8080/api/admins/classes', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                if (response.ok) {
                    alert('Class created successfully!');
                    // Reset the form fields
                    document.getElementById('className').value = '';
                    document.getElementById('startTime').value = '';
                    document.getElementById('endTime').value = '';
                    document.getElementById('dayOfWeek').selectedIndex = 0;
                    document.getElementById('courseDropdown').selectedIndex = 0;
                } else {
                    alert('Error creating class. Please check the details and try again.');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error creating class.');
            }
        }

        async function populateClassesDropdown() {
            try {
                const response = await fetch('http://localhost:8080/api/admins/classes'); // Endpoint to fetch classes
                const classes = await response.json();

                const dropdown = document.getElementById('classDropdown');
                dropdown.innerHTML = ''; // Clear existing options
                classes.forEach(classItem => {
                    const option = document.createElement('option');
                    option.value = classItem.id; // Use class ID for the value
                    option.textContent = classItem.className; // Display class name
                    dropdown.appendChild(option);
                });
            } catch (error) {
                console.error('Error fetching classes:', error);
                // Optionally handle errors here, such as showing an error message
            }
        }

        async function assignInstructorToClass(event) {
            event.preventDefault();

            const instructorId = document.getElementById('instructorDropdownForAssignment').value;
            const classId = document.getElementById('classDropdown').value;

            try {
                const response = await fetch(`http://localhost:8080/api/admins/classes/${classId}/instructors/${instructorId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    alert('Instructor assigned to class successfully!');
                    // Optionally, reset the form fields
                    document.getElementById('instructorDropdownForAssignment').selectedIndex = 0;
                    document.getElementById('classDropdown').selectedIndex = 0;
                } else {
                    const errorData = await response.json();
                    alert('Error assigning instructor to class: ' + (errorData.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error assigning instructor to class: ' + error.message);
            }
        }

        async function populateInstructorDropdownForAssignment() {
            try {
                const response = await fetch('http://localhost:8080/api/instructors');
                const instructors = await response.json();

                const instructorDropdownForAssignment = document.getElementById('instructorDropdownForAssignment');
                instructorDropdownForAssignment.innerHTML = ''; // Clear existing options
                instructors.forEach(instructor => {
                    const option = document.createElement('option');
                    option.value = instructor.id;
                    option.textContent = `${instructor.firstName} ${instructor.lastName}`; // Display full name
                    instructorDropdownForAssignment.appendChild(option);
                });
            } catch (error) {
                console.error('Error fetching instructors:', error);
            }
        }

        function showAssignInstructorForm() {
            // Show the assign instructor form section
            showSection('assign-instructor-form');

            // Populate the instructors dropdown with the instructor data
            populateInstructorsDropdown();
        }
        async function populateInstructorsDropdown() {
            try {
                const response = await fetch('http://localhost:8080/api/instructors');
                const instructors = await response.json();

                const instructorDropdown = document.getElementById('instructorDropdown');
                instructorDropdown.innerHTML = ''; // Clear existing options
                instructors.forEach(instructor => {
                    const option = document.createElement('option');
                    option.value = instructor.id;
                    option.textContent = `${instructor.firstName} ${instructor.lastName}`; // Display full name
                    instructorDropdown.appendChild(option);
                });
            } catch (error) {
                console.error('Error fetching instructors:', error);
            }
        }

        function viewReports() {
            window.location.href = 'reports.html';
        }

        async function fetchAndDisplayStudents() {
            const response = await fetch('http://localhost:8080/api/students');
            const students = await response.json();

            const tableBody = document.querySelector('#studentsTable tbody');
            tableBody.innerHTML = ''; // Clear existing rows

            students.forEach(student => {
                const row = document.createElement('tr');

                row.innerHTML = `
            <td>${student.id}</td>
            <td>${student.firstName}</td>
            <td>${student.lastName}</td>
            <td>${student.email}</td>
            <td>${student.rfidTag ? student.rfidTag.tagNumber : 'N/A'}</td>
            <td>${student.user ? student.user.username : 'N/A'}</td>
            <td>
                <button class="edit-button" onclick="showEditForm(${student.id})">Edit</button>
                <button class="delete-button" onclick="deleteStudent(${student.id})">Delete</button>
            </td>
        `;

                tableBody.appendChild(row);
            }); // Closing bracket for forEach
        } // Closing bracket for fetchAndDisplayStudents

        async function populateDropdowns() {
            try {
                // Populate RFID Tags dropdown
                // const rfidResponse = await fetch('http://localhost:8080/api/rfid-tags');
                // const rfidTags = await rfidResponse.json();

                // const rfidDropdown = document.getElementById('editRFIDTagDropdown');
                // rfidDropdown.innerHTML = ''; // Clear existing options
                // rfidTags.forEach(tag => {
                //     const option = document.createElement('option');
                //     option.value = tag.id;
                //     option.textContent = tag.tagNumber;
                //     rfidDropdown.appendChild(option);
                // });

                //Populate Users dropdown
                const userResponse = await fetch('http://localhost:8080/api/users');
                const users = await userResponse.json();

                const userDropdown = document.getElementById('editUserDropdown');
                userDropdown.innerHTML = ''; // Clear existing options
                users.forEach(user => {
                    const option = document.createElement('option');
                    option.value = user.id;
                    option.textContent = user.username; // Assuming you have a username or similar field
                    userDropdown.appendChild(option);
                });
            } catch (error) {
                console.error('Error fetching dropdown data:', error);
            }
        }

        async function populateUserDropdownForInstructor() {
            try {
                // Populate Users dropdown
                const userResponse = await fetch('http://localhost:8080/api/users');
                const users = await userResponse.json();

                const userDropdown = document.getElementById('editUserDropdownInt');
                userDropdown.innerHTML = ''; // Clear existing options
                users.forEach(user => {
                    const option = document.createElement('option');
                    option.value = user.id;
                    option.textContent = user.username; // Assuming you have a username or similar field
                    userDropdown.appendChild(option);
                });
            } catch (error) {
                console.error('Error fetching dropdown data:', error);
            }
        }

        async function showEditForm(studentId) {
            // Show the students table section
            showStudentsTable();

            try {
                const response = await fetch(`http://localhost:8080/api/students/${studentId}`);
                const student = await response.json();

                // Populate the edit form with student data
                document.getElementById('editStudentId').value = student.id;
                document.getElementById('editStudentFirstName').value = student.firstName;
                document.getElementById('editStudentLastName').value = student.lastName;
                document.getElementById('editStudentEmail').value = student.email;

                // Pre-select the RFID Tag in the dropdown
                document.getElementById('editRFIDTagDropdown').value = student.rfidTag?.id || '';

                // Autofill and disable the User dropdown
                const userDropdown = document.getElementById('editUserDropdown');
                userDropdown.innerHTML = ''; // Clear existing options
                if (student.user) {
                    const option = document.createElement('option');
                    option.value = student.user.id;
                    option.textContent = student.user.username;
                    userDropdown.appendChild(option);
                    userDropdown.value = student.user.id;
                }
                userDropdown.disabled = true;

                // Populate RFID tags dropdown
                await populateRFIDTags(studentId);

                // Show the edit form section
                const editForm = document.getElementById('edit-student-form');
                editForm.style.display = 'block';

                // Scroll to the edit form
                editForm.scrollIntoView({ behavior: 'smooth' });
            } catch (error) {
                console.error('Error fetching student details:', error);
                alert('Error fetching student details: ' + error.message);
            }
        }

        function hideEditForm() {
            // Hide the edit form section
            document.getElementById('edit-student-form').style.display = 'none';

            // Show the students table section
            document.getElementById('students-table-section').style.display = 'block';

            // Scroll back to the students table
            document.getElementById('students-table-section').scrollIntoView({ behavior: 'smooth' });
        }

        async function populateRFIDTags(studentId) {
            try {
                // Fetch unassigned RFID tags
                const unassignedResponse = await fetch('http://localhost:8080/api/rfid-tags/unassigned');
                const unassignedTags = await unassignedResponse.json();

                // Fetch the student's RFID tag if it exists
                const studentResponse = await fetch(`http://localhost:8080/api/students/${studentId}`);
                const studentData = await studentResponse.json();

                const rfidTagDropdown = document.getElementById('editRFIDTagDropdown');
                rfidTagDropdown.innerHTML = ''; // Clear existing options

                // Add the student's RFID tag at the top if it exists
                if (studentData.rfidTag) {
                    const studentTagOption = document.createElement('option');
                    studentTagOption.value = studentData.rfidTag.id;
                    studentTagOption.textContent = studentData.rfidTag.tagNumber;
                    studentTagOption.selected = true; // Set as selected
                    rfidTagDropdown.appendChild(studentTagOption);
                }

                // Populate with unassigned RFID tags
                unassignedTags.forEach(tag => {
                    const option = document.createElement('option');
                    option.value = tag.id;
                    option.textContent = tag.tagNumber;

                    // Prevent adding duplicate option if the student's tag is already in the list
                    if (!studentData.rfidTag || tag.id !== studentData.rfidTag.id) {
                        rfidTagDropdown.appendChild(option);
                    }
                });

            } catch (error) {
                console.error('Error fetching RFID tags:', error);
                alert('Error fetching RFID tags: ' + error.message);
            }
        }

        async function editStudent(event) {
            event.preventDefault();

            const studentId = document.getElementById('editStudentId').value;
            const firstName = document.getElementById('editStudentFirstName').value;
            const lastName = document.getElementById('editStudentLastName').value;
            const email = document.getElementById('editStudentEmail').value;
            const rfidTagId = document.getElementById('editRFIDTagDropdown').value;
            const userId = document.getElementById('editUserDropdown').value;

            try {

                // Fetch existing student data
                const studentResponse = await fetch(`http://localhost:8080/api/students/${studentId}`);
                if (!studentResponse.ok) {
                    throw new Error('Failed to retrieve student details.');
                }
                const studentData = await studentResponse.json();

                // Fetch existing user data
                const userResponse = await fetch(`http://localhost:8080/api/users/${userId}`);
                if (!userResponse.ok) {
                    throw new Error('Failed to retrieve user details.');
                }
                const userData = await userResponse.json();

                // Construct the payload
                const payload = {
                    id: parseInt(studentId),
                    firstName,
                    lastName,
                    email,
                    faceDescriptors: studentData.faceDescriptors || null,
                    rfidTagId: rfidTagId ? parseInt(rfidTagId) : null,
                    user: {
                        id: parseInt(userId),
                        username: userData.username,
                        password: userData.password,
                        role: userData.role,
                        admin: null
                    },
                    rfidTag: rfidTagId ? { id: parseInt(rfidTagId) } : null
                };

                // Send the PUT request
                const response = await fetch('http://localhost:8080/api/admins/students', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                if (response.ok) {
                    alert('Student details updated successfully!');
                    hideEditForm();
                    fetchAndDisplayStudents(); // Refresh the table after editing
                } else {
                    const result = await response.json();
                    alert('Error updating student details: ' + (result.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error updating student: ' + error.message);
            }
        }

        async function deleteStudent(studentId) {
            if (!confirm('Are you sure you want to delete this student?')) {
                return;
            }

            try {
                const response = await fetch(`http://localhost:8080/api/students/${studentId}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    alert('Student deleted successfully!');
                    fetchAndDisplayStudents(); // Refresh the table after deletion
                } else {
                    alert('Error deleting student.');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error deleting student.');
            }
        }

        // Fetch and display instructors in the table
        async function fetchAndDisplayInstructors() {
            try {
                const response = await fetch('http://localhost:8080/api/instructors');

                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }

                const instructors = await response.json();

                const instructorsTableBody = document.querySelector('#instructorsTable tbody');
                instructorsTableBody.innerHTML = ''; // Clear existing rows

                instructors.forEach(instructor => {
                    const row = document.createElement('tr');

                    // Check if userId exists and display a default value if not
                    const userIdDisplay = instructor.user ? instructor.user.username : 'N/A';

                    row.innerHTML = `
                <td>${instructor.id}</td>
                <td>${instructor.firstName}</td>
                <td>${instructor.lastName}</td>
                <td>${instructor.email}</td>
                <td>${userIdDisplay}</td>
                <td>
                    <button class="edit-button" onclick="showEditInstructorForm(${instructor.id})">Edit</button>
                    <button class="delete-button" onclick="deleteInstructor(${instructor.id})">Delete</button>
                </td>
            `;

                    instructorsTableBody.appendChild(row);
                });
            } catch (error) {
                console.error('Error fetching instructors:', error);
            }
        }

        async function showEditInstructorForm(instructorId) {
            showInstructorsTable();

            try {
                const response = await fetch(`http://localhost:8080/api/instructors/${instructorId}`);
                const instructor = await response.json();

                // Populate instructor data into the form
                document.getElementById('editInstructorId').value = instructor.id;
                document.getElementById('editInstructorFirstName').value = instructor.firstName;
                document.getElementById('editInstructorLastName').value = instructor.lastName;
                document.getElementById('editInstructorEmail').value = instructor.email;

                // Autofill and disable the User dropdown
                const userDropdown = document.getElementById('editUserDropdownInt');
                userDropdown.innerHTML = ''; // Clear existing options
                if (instructor.user) {
                    const option = document.createElement('option');
                    option.value = instructor.user.id;
                    option.textContent = instructor.user.username;
                    userDropdown.appendChild(option);
                    userDropdown.value = instructor.user.id;
                }
                userDropdown.disabled = true;

                // Show the edit instructor form
                const editForm = document.getElementById('edit-instructor-form');
                editForm.style.display = 'block';

                // Hide the instructors table when editing
                document.getElementById('instructors-table-section').style.display = 'none';

                // Scroll to the edit form
                editForm.scrollIntoView({ behavior: 'smooth' });
            } catch (error) {
                console.error('Error fetching instructor details:', error);
                alert('Error fetching instructor details: ' + error.message);
            }
        }

        function hideEditInstructorForm() {
            // Hide the edit form section
            document.getElementById('edit-instructor-form').style.display = 'none';

            // Show the instructors table section
            const instructorsTable = document.getElementById('instructors-table-section');
            instructorsTable.style.display = 'block';

            // Scroll back to the instructors table
            instructorsTable.scrollIntoView({ behavior: 'smooth' });
        }

        // Update the editInstructor function
        async function editInstructor(event) {
            event.preventDefault();

            const instructorId = document.getElementById('editInstructorId').value;
            const firstName = document.getElementById('editInstructorFirstName').value;
            const lastName = document.getElementById('editInstructorLastName').value;
            const email = document.getElementById('editInstructorEmail').value;
            const userId = document.getElementById('editUserDropdownInt').value;

            try {
                // Fetch the user details to preserve sensitive information
                const userResponse = await fetch(`http://localhost:8080/api/users/${userId}`);
                if (!userResponse.ok) {
                    throw new Error('Failed to retrieve user details.');
                }
                const userDetails = await userResponse.json();

                // Construct the payload, preserving existing user information such as password
                const payload = {
                    id: parseInt(instructorId),
                    firstName,
                    lastName,
                    email,
                    user: {
                        id: parseInt(userId),
                        username: userDetails.username,
                        password: userDetails.password, // Preserve the actual password
                        role: userDetails.role // Preserve the role information
                    }
                };

                // Send the PUT request to update the instructor
                const response = await fetch('http://localhost:8080/api/admins/instructors', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                if (response.ok) {
                    alert('Instructor details updated successfully!');
                    hideEditInstructorForm();
                    fetchAndDisplayInstructors(); // Refresh the table after editing
                } else {
                    const result = await response.json();
                    alert('Error updating instructor details: ' + (result.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error updating instructor: ' + error.message);
            }
        }

        // Delete an instructor
        async function deleteInstructor(instructorId) {
            if (!confirm('Are you sure you want to delete this instructor?')) {
                return;
            }

            try {
                const response = await fetch(`http://localhost:8080/api/instructors/${instructorId}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    alert('Instructor deleted successfully!');
                    fetchAndDisplayInstructors(); // Refresh the table after deletion
                } else {
                    alert('Error deleting instructor.');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error deleting instructor.');
            }
        }


        // Function to create a new RFID tag
        async function createRFIDTag(event) {
            event.preventDefault();
            const tagNumber = document.getElementById('newTagNumber').value;

            try {
                const response = await fetch('http://localhost:8080/api/rfid-tags', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ tagNumber: tagNumber })
                });

                if (response.ok) {
                    alert('RFID tag created successfully!');
                    document.getElementById('newTagNumber').value = ''; // Clear the input
                    populateUnassignedTagsDropdown(); // Refresh the unassigned tags dropdown
                } else {
                    const errorData = await response.json();
                    alert('Error creating RFID tag: ' + (errorData.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error creating RFID tag: ' + error.message);
            }
        }

        // Function to assign an RFID tag to a student
        async function assignRFIDTag(event) {
            event.preventDefault();
            const studentId = document.getElementById('studentDropdown').value;
            const rfidTagId = document.getElementById('unassignedTagDropdown').value;

            try {
                const response = await fetch(`http://localhost:8080/api/admins/students/${studentId}/rfid-tags/${rfidTagId}`, {
                    method: 'PUT'
                });

                if (response.ok) {
                    alert('RFID tag assigned to student successfully!');
                    populateStudentsDropdown(); // Refresh the students dropdown
                    populateUnassignedTagsDropdown(); // Refresh the unassigned tags dropdown
                } else {
                    const errorData = await response.json();
                    alert('Error assigning RFID tag: ' + (errorData.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error assigning RFID tag: ' + error.message);
            }
        }

        // Function to populate the students dropdown
        async function populateStudentsDropdown() {
            try {
                const response = await fetch('http://localhost:8080/api/students');
                const students = await response.json();

                const dropdown = document.getElementById('studentDropdown');
                dropdown.innerHTML = ''; // Clear existing options
                students.forEach(student => {
                    const option = document.createElement('option');
                    option.value = student.id;
                    option.textContent = `${student.firstName} ${student.lastName}`;
                    dropdown.appendChild(option);
                });
            } catch (error) {
                console.error('Error fetching students:', error);
                alert('Error fetching students: ' + error.message);
            }
        }

        // Function to populate the unassigned RFID tags dropdown
        async function populateUnassignedTagsDropdown() {
            try {
                const response = await fetch('http://localhost:8080/api/rfid-tags/unassigned');
                const unassignedTags = await response.json();

                const dropdown = document.getElementById('unassignedTagDropdown');
                dropdown.innerHTML = ''; // Clear existing options
                unassignedTags.forEach(tag => {
                    const option = document.createElement('option');
                    option.value = tag.id;
                    option.textContent = tag.tagNumber;
                    dropdown.appendChild(option);
                });
            } catch (error) {
                console.error('Error fetching unassigned RFID tags:', error);
                alert('Error fetching unassigned RFID tags: ' + error.message);
            }
        }
    </script>
</body>

</html>